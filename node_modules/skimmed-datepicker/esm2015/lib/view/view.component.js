/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import { ChangeDetectionStrategy, Component, EventEmitter, HostBinding, Input, Output } from '@angular/core';
import { WeekDay } from '@angular/common';
import { zoom } from '../util/zoom.animation';
import { ViewMode } from '../datepicker/view-mode';
import { ViewStrategy } from '../view-strategies/view-strategy';
export class ViewComponent {
    /**
     * @param {?} viewStrategy
     */
    constructor(viewStrategy) {
        this.viewStrategy = viewStrategy;
        this.itemChange = new EventEmitter();
        this.headerClick = new EventEmitter();
        this.ViewMode = ViewMode;
        this.prevDisabled = false;
        this.nextDisabled = false;
        this.regularTimestampFields = ['currentTimestamp', 'selectedTimestamp', 'minTimestamp', 'maxTimestamp'];
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (this.viewStrategy.viewMode !== ViewMode.Days) {
            this.regularTimestampFields.forEach(field => {
                if (field in changes) {
                    this[field] = this[field] ? this.viewStrategy.normalizeTimestamp(this[field]) : undefined;
                }
            });
        }
        if ('initialTimestamp' in changes) {
            // Must be called after normalization of other timestamps for proper behavior of min-max range
            this.initPanes(this.initialTimestamp);
        }
    }
    /**
     * @param {?} index
     * @return {?}
     */
    trackIndex(index) {
        return index;
    }
    /**
     * @param {?} notPanning
     * @return {?}
     */
    clickHeader(notPanning) {
        if (notPanning) {
            this.headerClick.emit(this.panes[this.visiblePaneIndex].values[0]);
        }
    }
    /**
     * @param {?} event
     * @param {?} pane
     * @param {?} notPanning
     * @return {?}
     */
    selectItem(event, pane, notPanning) {
        if (notPanning) {
            const /** @type {?} */ button = /** @type {?} */ (event.target);
            const /** @type {?} */ index = button.dataset["index"];
            if (this.deselectEnabled && pane.values[index] === this.selectedTimestamp) {
                this.itemChange.emit(undefined);
            }
            else {
                this.itemChange.emit(pane.values[index]);
            }
        }
    }
    /**
     * @param {?} direction
     * @return {?}
     */
    switchPanes(direction) {
        this.visiblePaneIndex = (3 + this.visiblePaneIndex + direction) % 3;
        const /** @type {?} */ index = (3 + this.visiblePaneIndex + direction) % 3;
        const /** @type {?} */ pane = this.panes[index];
        this.panes[index] = this.viewStrategy.makePane(pane.values[0], 3 * direction, pane.order, this.weekStart);
        this.updateDisabledStatus((3 + this.visiblePaneIndex - 1) % 3, (3 + this.visiblePaneIndex + 1) % 3);
    }
    /**
     * @param {?} timestamp
     * @return {?}
     */
    initPanes(timestamp) {
        const /** @type {?} */ seed = this.viewStrategy.makeInitPanesSeed(timestamp);
        this.panes = [-1, 0, 1].map(i => this.viewStrategy.makePane(seed, i, 0, this.weekStart));
        this.visiblePaneIndex = 1;
        this.updateDisabledStatus(0, 2);
    }
    /**
     * @param {?} prevIndex
     * @param {?} nextIndex
     * @return {?}
     */
    updateDisabledStatus(prevIndex, nextIndex) {
        this.prevDisabled = this.panes[prevIndex].values[this.panes[prevIndex].values.length - 1] < this.minTimestamp;
        this.nextDisabled = this.panes[nextIndex].values[0] > this.maxTimestamp;
    }
}
ViewComponent.decorators = [
    { type: Component, args: [{
                selector: 'skm-view',
                template: `<skm-slider [prevDisabled]="prevDisabled" [nextDisabled]="nextDisabled" (slideDone)="switchPanes($event)" #slider>
  <div class="skm-datepicker-pane" *ngFor="let pane of panes; trackBy: trackIndex" [style.order]="pane.order">
    <button type="button" class="skm-datepicker-header"
            (click)="clickHeader(slider.notPanning)" [disabled]="viewStrategy.viewMode === ViewMode.Years">
      {{pane.values[0] | date:headingFormat}}
      <ng-container *ngIf="viewStrategy.viewMode === ViewMode.Years">
        &ndash; {{pane.values[19] | date:headingFormat}}
      </ng-container>
    </button>
    <div class="skm-datepicker-week" *ngIf="viewStrategy.viewMode === ViewMode.Days">
      <div class="skm-datepicker-weekday" *ngFor="let label of weekDayLabels | slice:weekStart:7">{{label}}</div>
      <div class="skm-datepicker-weekday" *ngFor="let label of weekDayLabels | slice:0:weekStart">{{label}}</div>
    </div>
    <skm-grid
      [pane]="pane"
      [currentTimestamp]="currentTimestamp"
      [selectedTimestamp]="selectedTimestamp"
      [minTimestamp]="minTimestamp"
      [maxTimestamp]="maxTimestamp"
      [itemFormat]="itemFormat"
      [itemLabels]="itemLabels"
    ></skm-grid>
  </div>
</skm-slider>
`,
                styles: [`button{display:block;color:inherit}button:not([disabled]){cursor:pointer}button[disabled]{pointer-events:none}.skm-datepicker-pane{flex-shrink:0;width:100%;display:flex;flex-direction:column;overflow:hidden}.skm-datepicker-week{display:flex}.skm-datepicker-weekday{width:14.28571%}.skm-datepicker-content{flex:1 0 0;display:flex;flex-direction:column}.skm-datepicker-grid{flex:1 0 0;display:flex;flex-wrap:wrap;align-content:flex-start;pointer-events:none}.skm-datepicker-indent{height:16.66667%}.skm-datepicker-cell{display:flex}:host-context(.skm-datepicker-days-view) .skm-datepicker-cell{width:14.28571%;height:16.66667%}:host-context(.skm-datepicker-months-view) .skm-datepicker-cell{width:33.33333%;height:25%}:host-context(.skm-datepicker-years-view) .skm-datepicker-cell{width:20%;height:25%}.skm-datepicker-item{flex:1;pointer-events:auto}`],
                animations: [zoom()],
                changeDetection: ChangeDetectionStrategy.OnPush,
            },] },
];
/** @nocollapse */
ViewComponent.ctorParameters = () => [
    { type: ViewStrategy, },
];
ViewComponent.propDecorators = {
    "zoomDirection": [{ type: Input }, { type: HostBinding, args: ['@zoom',] },],
    "initialTimestamp": [{ type: Input },],
    "currentTimestamp": [{ type: Input },],
    "selectedTimestamp": [{ type: Input },],
    "minTimestamp": [{ type: Input },],
    "maxTimestamp": [{ type: Input },],
    "deselectEnabled": [{ type: Input },],
    "headingFormat": [{ type: Input },],
    "weekStart": [{ type: Input },],
    "weekDayLabels": [{ type: Input },],
    "itemFormat": [{ type: Input },],
    "itemLabels": [{ type: Input },],
    "itemChange": [{ type: Output },],
    "headerClick": [{ type: Output },],
};
function ViewComponent_tsickle_Closure_declarations() {
    /** @type {!Array<{type: !Function, args: (undefined|!Array<?>)}>} */
    ViewComponent.decorators;
    /**
     * @nocollapse
     * @type {function(): !Array<(null|{type: ?, decorators: (undefined|!Array<{type: !Function, args: (undefined|!Array<?>)}>)})>}
     */
    ViewComponent.ctorParameters;
    /** @type {!Object<string,!Array<{type: !Function, args: (undefined|!Array<?>)}>>} */
    ViewComponent.propDecorators;
    /** @type {?} */
    ViewComponent.prototype.zoomDirection;
    /** @type {?} */
    ViewComponent.prototype.initialTimestamp;
    /** @type {?} */
    ViewComponent.prototype.currentTimestamp;
    /** @type {?} */
    ViewComponent.prototype.selectedTimestamp;
    /** @type {?} */
    ViewComponent.prototype.minTimestamp;
    /** @type {?} */
    ViewComponent.prototype.maxTimestamp;
    /** @type {?} */
    ViewComponent.prototype.deselectEnabled;
    /** @type {?} */
    ViewComponent.prototype.headingFormat;
    /** @type {?} */
    ViewComponent.prototype.weekStart;
    /** @type {?} */
    ViewComponent.prototype.weekDayLabels;
    /** @type {?} */
    ViewComponent.prototype.itemFormat;
    /** @type {?} */
    ViewComponent.prototype.itemLabels;
    /** @type {?} */
    ViewComponent.prototype.itemChange;
    /** @type {?} */
    ViewComponent.prototype.headerClick;
    /** @type {?} */
    ViewComponent.prototype.ViewMode;
    /** @type {?} */
    ViewComponent.prototype.panes;
    /** @type {?} */
    ViewComponent.prototype.prevDisabled;
    /** @type {?} */
    ViewComponent.prototype.nextDisabled;
    /** @type {?} */
    ViewComponent.prototype.visiblePaneIndex;
    /** @type {?} */
    ViewComponent.prototype.regularTimestampFields;
    /** @type {?} */
    ViewComponent.prototype.viewStrategy;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmlldy5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9za2ltbWVkLWRhdGVwaWNrZXIvIiwic291cmNlcyI6WyJsaWIvdmlldy92aWV3LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLHVCQUF1QixFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsV0FBVyxFQUFFLEtBQUssRUFBYSxNQUFNLEVBQWlCLE1BQU0sZUFBZSxDQUFDO0FBQ3ZJLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUUxQyxPQUFPLEVBQUUsSUFBSSxFQUFpQixNQUFNLHdCQUF3QixDQUFDO0FBQzdELE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUNuRCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sa0NBQWtDLENBQUM7QUFpQ2hFLE1BQU07Ozs7SUE0QkosWUFBcUIsWUFBMEI7UUFBMUIsaUJBQVksR0FBWixZQUFZLENBQWM7MEJBWGYsSUFBSSxZQUFZLEVBQVU7MkJBQ3pCLElBQUksWUFBWSxFQUFVO3dCQUV2QyxRQUFROzRCQUdiLEtBQUs7NEJBQ0wsS0FBSztzQ0FFYSxDQUFDLGtCQUFrQixFQUFFLG1CQUFtQixFQUFFLGNBQWMsRUFBRSxjQUFjLENBQUM7S0FHekc7Ozs7O0lBRUQsV0FBVyxDQUFDLE9BQXNCO1FBQ2hDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsUUFBUSxLQUFLLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQ2pELElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEVBQUU7Z0JBQzFDLEVBQUUsQ0FBQyxDQUFDLEtBQUssSUFBSSxPQUFPLENBQUMsQ0FBQyxDQUFDO29CQUNyQixJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMs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ekYsSUFBSSxDQUFDLGdCQUFnQixHQUFHLENBQUMsQ0FBQztRQUMxQixJQUFJLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDOzs7Ozs7O0lBRzFCLG9CQUFvQixDQUFDLFNBQWlCLEVBQUUsU0FBaUI7UUFDL0QsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQztRQUM5RyxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUM7Ozs7WUFuSDNFLFNBQVMsU0FBQztnQkFDVCxRQUFRLEVBQUUsVUFBVTtnQkFDcEIsUUFBUSxFQUFFOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Q0F3Qlg7Z0JBQ0MsTUFBTSxFQUFFLENBQUMsazFCQUFrMUIsQ0FBQztnQkFDNTFCLFVBQVUsRUFBRSxDQUFDLElBQUksRUFBRSxDQUFDO2dCQUNwQixlQUFlLEVBQUUsdUJBQXVCLENBQUMsTUFBTTthQUNoRDs7OztZQWhDUSxZQUFZOzs7OEJBa0NsQixLQUFLLFlBQUksV0FBVyxTQUFDLE9BQU87aUNBQzVCLEtBQUs7aUNBRUwsS0FBSztrQ0FDTCxLQUFLOzZCQUNMLEtBQUs7NkJBQ0wsS0FBSztnQ0FFTCxLQUFLOzhCQUVMLEtBQUs7MEJBQ0wsS0FBSzs4QkFDTCxLQUFLOzJCQUNMLEtBQUs7MkJBQ0wsS0FBSzsyQkFFTCxNQUFNOzRCQUNOLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSwgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIEhvc3RCaW5kaW5nLCBJbnB1dCwgT25DaGFuZ2VzLCBPdXRwdXQsIFNpbXBsZUNoYW5nZXMgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgV2Vla0RheSB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XHJcbmltcG9ydCB7IFBhbmUgfSBmcm9tICcuLi9wYW5lJztcclxuaW1wb3J0IHsgem9vbSwgWm9vbURpcmVjdGlvbiB9IGZyb20gJy4uL3V0aWwvem9vbS5hbmltYXRpb24nO1xyXG5pbXBvcnQgeyBWaWV3TW9kZSB9IGZyb20gJy4uL2RhdGVwaWNrZXIvdmlldy1tb2RlJztcclxuaW1wb3J0IHsgVmlld1N0cmF0ZWd5IH0gZnJvbSAnLi4vdmlldy1zdHJhdGVnaWVzL3ZpZXctc3RyYXRlZ3knO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdza20tdmlldycsXHJcbiAgdGVtcGxhdGU6IGA8c2ttLXNsaWRlciBbcHJldkRpc2FibGVkXT1cInByZXZEaXNhYmxlZFwiIFtuZXh0RGlzYWJsZWRdPVwibmV4dERpc2FibGVkXCIgKHNsaWRlRG9uZSk9XCJzd2l0Y2hQYW5lcygkZXZlbnQpXCIgI3NsaWRlcj5cclxuICA8ZGl2IGNsYXNzPVwic2ttLWRhdGVwaWNrZXItcGFuZVwiICpuZ0Zvcj1cImxldCBwYW5lIG9mIHBhbmVzOyB0cmFja0J5OiB0cmFja0luZGV4XCIgW3N0eWxlLm9yZGVyXT1cInBhbmUub3JkZXJcIj5cclxuICAgIDxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwic2ttLWRhdGVwaWNrZXItaGVhZGVyXCJcclxuICAgICAgICAgICAgKGNsaWNrKT1cImNsaWNrSGVhZGVyKHNsaWRlci5ub3RQYW5uaW5nKVwiIFtkaXNhYmxlZF09XCJ2aWV3U3RyYXRlZ3kudmlld01vZGUgPT09IFZpZXdNb2RlLlllYXJzXCI+XHJcbiAgICAgIHt7cGFuZS52YWx1ZXNbMF0gfCBkYXRlOmhlYWRpbmdGb3JtYXR9fVxyXG4gICAgICA8bmctY29udGFpbmVyICpuZ0lmPVwidmlld1N0cmF0ZWd5LnZpZXdNb2RlID09PSBWaWV3TW9kZS5ZZWFyc1wiPlxyXG4gICAgICAgICZuZGFzaDsge3twYW5lLnZhbHVlc1sxOV0gfCBkYXRlOmhlYWRpbmdGb3JtYXR9fVxyXG4gICAgICA8L25nLWNvbnRhaW5lcj5cclxuICAgIDwvYnV0dG9uPlxyXG4gICAgPGRpdiBjbGFzcz1cInNrbS1kYXRlcGlja2VyLXdlZWtcIiAqbmdJZj1cInZpZXdTdHJhdGVneS52aWV3TW9kZSA9PT0gVmlld01vZGUuRGF5c1wiPlxyXG4gICAgICA8ZGl2IGNsYXNzPVwic2ttLWRhdGVwaWNrZXItd2Vla2RheVwiICpuZ0Zvcj1cImxldCBsYWJlbCBvZiB3ZWVrRGF5TGFiZWxzIHwgc2xpY2U6d2Vla1N0YXJ0OjdcIj57e2xhYmVsfX08L2Rpdj5cclxuICAgICAgPGRpdiBjbGFzcz1cInNrbS1kYXRlcGlja2VyLXdlZWtkYXlcIiAqbmdGb3I9XCJsZXQgbGFiZWwgb2Ygd2Vla0RheUxhYmVscyB8IHNsaWNlOjA6d2Vla1N0YXJ0XCI+e3tsYWJlbH19PC9kaXY+XHJcbiAgICA8L2Rpdj5cclxuICAgIDxza20tZ3JpZFxyXG4gICAgICBbcGFuZV09XCJwYW5lXCJcclxuICAgICAgW2N1cnJlbnRUaW1lc3RhbXBdPVwiY3VycmVudFRpbWVzdGFtcFwiXHJcbiAgICAgIFtzZWxlY3RlZFRpbWVzdGFtcF09XCJzZWxlY3RlZFRpbWVzdGFtcFwiXHJcbiAgICAgIFttaW5UaW1lc3RhbXBdPVwibWluVGltZXN0YW1wXCJcclxuICAgICAgW21heFRpbWVzdGFtcF09XCJtYXhUaW1lc3RhbXBcIlxyXG4gICAgICBbaXRlbUZvcm1hdF09XCJpdGVtRm9ybWF0XCJcclxuICAgICAgW2l0ZW1MYWJlbHNdPVwiaXRlbUxhYmVsc1wiXHJcbiAgICA+PC9za20tZ3JpZD5cclxuICA8L2Rpdj5cclxuPC9za20tc2xpZGVyPlxyXG5gLFxyXG4gIHN0eWxlczogW2BidXR0b257ZGlzcGxheTpibG9jaztjb2xvcjppbmhlcml0fWJ1dHRvbjpub3QoW2Rpc2FibGVkXSl7Y3Vyc29yOnBvaW50ZXJ9YnV0dG9uW2Rpc2FibGVkXXtwb2ludGVyLWV2ZW50czpub25lfS5za20tZGF0ZXBpY2tlci1wYW5le2ZsZXgtc2hyaW5rOjA7d2lkdGg6MTAwJTtkaXNwbGF5OmZsZXg7ZmxleC1kaXJlY3Rpb246Y29sdW1uO292ZXJmbG93OmhpZGRlbn0uc2ttLWRhdGVwaWNrZXItd2Vla3tkaXNwbGF5OmZsZXh9LnNrbS1kYXRlcGlja2VyLXdlZWtkYXl7d2lkdGg6MTQuMjg1NzElfS5za20tZGF0ZXBpY2tlci1jb250ZW50e2ZsZXg6MSAwIDA7ZGlzcGxheTpmbGV4O2ZsZXgtZGlyZWN0aW9uOmNvbHVtbn0uc2ttLWRhdGVwaWNrZXItZ3JpZHtmbGV4OjEgMCAwO2Rpc3BsYXk6ZmxleDtmbGV4LXdyYXA6d3JhcDthbGlnbi1jb250ZW50OmZsZXgtc3RhcnQ7cG9pbnRlci1ldmVudHM6bm9uZX0uc2ttLWRhdGVwaWNrZXItaW5kZW50e2hlaWdodDoxNi42NjY2NyV9LnNrbS1kYXRlcGlja2VyLWNlbGx7ZGlzcGxheTpmbGV4fTpob3N0LWNvbnRleHQoLnNrbS1kYXRlcGlja2VyLWRheXMtdmlldykgLnNrbS1kYXRlcGlja2VyLWNlbGx7d2lkdGg6MTQuMjg1NzElO2hlaWdodDoxNi42NjY2NyV9Omhvc3QtY29udGV4dCguc2ttLWRhdGVwaWNrZXItbW9udGhzLXZpZXcpIC5za20tZGF0ZXBpY2tlci1jZWxse3dpZHRoOjMzLjMzMzMzJTtoZWlnaHQ6MjUlfTpob3N0LWNvbnRleHQoLnNrbS1kYXRlcGlja2VyLXllYXJzLXZpZXcpIC5za20tZGF0ZXBpY2tlci1jZWxse3dpZHRoOjIwJTtoZWlnaHQ6MjUlfS5za20tZGF0ZXBpY2tlci1pdGVte2ZsZXg6MTtwb2ludGVyLWV2ZW50czphdXRvfWBdLFxyXG4gIGFuaW1hdGlvbnM6IFt6b29tKCldLFxyXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgVmlld0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uQ2hhbmdlcyB7XHJcbiAgQElucHV0KCkgQEhvc3RCaW5kaW5nKCdAem9vbScpIHpvb21EaXJlY3Rpb246IFpvb21EaXJlY3Rpb247XHJcbiAgQElucHV0KCkgaW5pdGlhbFRpbWVzdGFtcDogbnVtYmVyO1xyXG5cclxuICBASW5wdXQoKSBjdXJyZW50VGltZXN0YW1wOiBudW1iZXI7XHJcbiAgQElucHV0KCkgc2VsZWN0ZWRUaW1lc3RhbXA6IG51bWJlcjtcclxuICBASW5wdXQoKSBtaW5UaW1lc3RhbXA6IG51bWJlcjtcclxuICBASW5wdXQoKSBtYXhUaW1lc3RhbXA6IG51bWJlcjtcclxuXHJcbiAgQElucHV0KCkgZGVzZWxlY3RFbmFibGVkOiBib29sZWFuO1xyXG5cclxuICBASW5wdXQoKSBoZWFkaW5nRm9ybWF0OiBzdHJpbmc7XHJcbiAgQElucHV0KCkgd2Vla1N0YXJ0OiBXZWVrRGF5O1xyXG4gIEBJbnB1dCgpIHdlZWtEYXlMYWJlbHM6IHN0cmluZ1tdO1xyXG4gIEBJbnB1dCgpIGl0ZW1Gb3JtYXQ6IHN0cmluZztcclxuICBASW5wdXQoKSBpdGVtTGFiZWxzOiBzdHJpbmdbXTtcclxuXHJcbiAgQE91dHB1dCgpIHJlYWRvbmx5IGl0ZW1DaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPG51bWJlcj4oKTtcclxuICBAT3V0cHV0KCkgcmVhZG9ubHkgaGVhZGVyQ2xpY2sgPSBuZXcgRXZlbnRFbWl0dGVyPG51bWJlcj4oKTtcclxuXHJcbiAgcmVhZG9ubHkgVmlld01vZGUgPSBWaWV3TW9kZTtcclxuXHJcbiAgcGFuZXM6IEFycmF5PFBhbmU+O1xyXG4gIHByZXZEaXNhYmxlZCA9IGZhbHNlO1xyXG4gIG5leHREaXNhYmxlZCA9IGZhbHNlO1xyXG4gIHByaXZhdGUgdmlzaWJsZVBhbmVJbmRleDogbnVtYmVyO1xyXG4gIHByaXZhdGUgcmVndWxhclRpbWVzdGFtcEZpZWxkcyA9IFsnY3VycmVudFRpbWVzdGFtcCcsICdzZWxlY3RlZFRpbWVzdGFtcCcsICdtaW5UaW1lc3RhbXAnLCAnbWF4VGltZXN0YW1wJ107XHJcblxyXG4gIGNvbnN0cnVjdG9yKHJlYWRvbmx5IHZpZXdTdHJhdGVneTogVmlld1N0cmF0ZWd5KSB7XHJcbiAgfVxyXG5cclxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy52aWV3U3RyYXRlZ3kudmlld01vZGUgIT09IFZpZXdNb2RlLkRheXMpIHtcclxuICAgICAgdGhpcy5yZWd1bGFyVGltZXN0YW1wRmllbGRzLmZvckVhY2goZmllbGQgPT4ge1xyXG4gICAgICAgIGlmIChmaWVsZCBpbiBjaGFuZ2VzKSB7XHJcbiAgICAgICAgICB0aGlzW2ZpZWxkXSA9IHRoaXNbZmllbGRdID8gdGhpcy52aWV3U3RyYXRlZ3kubm9ybWFsaXplVGltZXN0YW1wKHRoaXNbZmllbGRdKSA6IHVuZGVmaW5lZDtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgaWYgKCdpbml0aWFsVGltZXN0YW1wJyBpbiBjaGFuZ2VzKSB7XHJcbiAgICAgIC8vIE11c3QgYmUgY2FsbGVkIGFmdGVyIG5vcm1hbGl6YXRpb24gb2Ygb3RoZXIgdGltZXN0YW1wcyBmb3IgcHJvcGVyIGJlaGF2aW9yIG9mIG1pbi1tYXggcmFuZ2VcclxuICAgICAgdGhpcy5pbml0UGFuZXModGhpcy5pbml0aWFsVGltZXN0YW1wKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHRyYWNrSW5kZXgoaW5kZXg6IG51bWJlcik6IG51bWJlciB7XHJcbiAgICByZXR1cm4gaW5kZXg7XHJcbiAgfVxyXG5cclxuICBjbGlja0hlYWRlcihub3RQYW5uaW5nOiBib29sZWFuKTogdm9pZCB7XHJcbiAgICBpZiAobm90UGFubmluZykge1xyXG4gICAgICB0aGlzLmhlYWRlckNsaWNrLmVtaXQodGhpcy5wYW5lc1t0aGlzLnZpc2libGVQYW5lSW5kZXhdLnZhbHVlc1swXSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBzZWxlY3RJdGVtKGV2ZW50OiBNb3VzZUV2ZW50LCBwYW5lOiBQYW5lLCBub3RQYW5uaW5nOiBib29sZWFuKTogdm9pZCB7XHJcbiAgICBpZiAobm90UGFubmluZykge1xyXG4gICAgICBjb25zdCBidXR0b24gPSBldmVudC50YXJnZXQgYXMgSFRNTEJ1dHRvbkVsZW1lbnQ7XHJcbiAgICAgIGNvbnN0IGluZGV4ID0gYnV0dG9uLmRhdGFzZXQuaW5kZXg7XHJcbiAgICAgIGlmICh0aGlzLmRlc2VsZWN0RW5hYmxlZCAmJiBwYW5lLnZhbHVlc1tpbmRleF0gPT09IHRoaXMuc2VsZWN0ZWRUaW1lc3RhbXApIHtcclxuICAgICAgICB0aGlzLml0ZW1DaGFuZ2UuZW1pdCh1bmRlZmluZWQpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuaXRlbUNoYW5nZS5lbWl0KHBhbmUudmFsdWVzW2luZGV4XSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHN3aXRjaFBhbmVzKGRpcmVjdGlvbjogbnVtYmVyKTogdm9pZCB7XHJcbiAgICB0aGlzLnZpc2libGVQYW5lSW5kZXggPSAoMyArIHRoaXMudmlzaWJsZVBhbmVJbmRleCArIGRpcmVjdGlvbikgJSAzO1xyXG4gICAgY29uc3QgaW5kZXggPSAoMyArIHRoaXMudmlzaWJsZVBhbmVJbmRleCArIGRpcmVjdGlvbikgJSAzO1xyXG4gICAgY29uc3QgcGFuZSA9IHRoaXMucGFuZXNbaW5kZXhdO1xyXG4gICAgdGhpcy5wYW5lc1tpbmRleF0gPSB0aGlzLnZpZXdTdHJhdGVneS5tYWtlUGFuZShwYW5lLnZhbHVlc1swXSwgMyAqIGRpcmVjdGlvbiwgcGFuZS5vcmRlciwgdGhpcy53ZWVrU3RhcnQpO1xyXG4gICAgdGhpcy51cGRhdGVEaXNhYmxlZFN0YXR1cygoMyArIHRoaXMudmlzaWJsZVBhbmVJbmRleCAtIDEpICUgMywgKDMgKyB0aGlzLnZpc2libGVQYW5lSW5kZXggKyAxKSAlIDMpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBpbml0UGFuZXModGltZXN0YW1wOiBudW1iZXIpOiB2b2lkIHtcclxuICAgIGNvbnN0IHNlZWQgPSB0aGlzLnZpZXdTdHJhdGVneS5tYWtlSW5pdFBhbmVzU2VlZCh0aW1lc3RhbXApO1xyXG4gICAgdGhpcy5wYW5lcyA9IFstMSwgMCwgMV0ubWFwKGkgPT4gdGhpcy52aWV3U3RyYXRlZ3kubWFrZVBhbmUoc2VlZCwgaSwgMCwgdGhpcy53ZWVrU3RhcnQpKTtcclxuICAgIHRoaXMudmlzaWJsZVBhbmVJbmRleCA9IDE7XHJcbiAgICB0aGlzLnVwZGF0ZURpc2FibGVkU3RhdHVzKDAsIDIpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSB1cGRhdGVEaXNhYmxlZFN0YXR1cyhwcmV2SW5kZXg6IG51bWJlciwgbmV4dEluZGV4OiBudW1iZXIpOiB2b2lkIHtcclxuICAgIHRoaXMucHJldkRpc2FibGVkID0gdGhpcy5wYW5lc1twcmV2SW5kZXhdLnZhbHVlc1t0aGlzLnBhbmVzW3ByZXZJbmRleF0udmFsdWVzLmxlbmd0aCAtIDFdIDwgdGhpcy5taW5UaW1lc3RhbXA7XHJcbiAgICB0aGlzLm5leHREaXNhYmxlZCA9IHRoaXMucGFuZXNbbmV4dEluZGV4XS52YWx1ZXNbMF0gPiB0aGlzLm1heFRpbWVzdGFtcDtcclxuICB9XHJcblxyXG59XHJcbiJdfQ==