/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import { ChangeDetectionStrategy, ChangeDetectorRef, Component, ElementRef, EventEmitter, Input, NgZone, Output, } from '@angular/core';
import { createEaseOut } from '../util/helpers';
import { slide } from './slide.animation';
import { fromEvent, Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
/**
 * @record
 */
export function AnimationTrigger() { }
function AnimationTrigger_tsickle_Closure_declarations() {
    /** @type {?} */
    AnimationTrigger.prototype.value;
    /** @type {?} */
    AnimationTrigger.prototype.params;
}
export class SliderComponent {
    /**
     * @param {?} hostRef
     * @param {?} cd
     * @param {?} zone
     */
    constructor(hostRef, cd, zone) {
        this.hostRef = hostRef;
        this.cd = cd;
        this.zone = zone;
        this.prevDisabled = false;
        this.nextDisabled = false;
        this.slideDone = new EventEmitter();
        this.notPanning = true;
        this.wrapperWidth = 1;
        this.panOffset = 0;
        this.ngUnsubscribe$ = new Subject();
        this.easeOut = createEaseOut(1.3);
        this.cd.detach();
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        this.changeSlideTrigger();
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.zone.runOutsideAngular(() => {
            const /** @type {?} */ host = this.hostRef.nativeElement;
            fromEvent(host, 'mousedown').pipe(takeUntil(this.ngUnsubscribe$)).subscribe(() => this.startPress());
            if ('Hammer' in window) {
                const /** @type {?} */ hammer = new Hammer(host);
                fromEvent(hammer, 'panstart').pipe(takeUntil(this.ngUnsubscribe$)).subscribe(() => this.startPan());
                fromEvent(hammer, 'panmove').pipe(takeUntil(this.ngUnsubscribe$)).subscribe(e => this.pan(e));
                fromEvent(hammer, 'panend pancancel').pipe(takeUntil(this.ngUnsubscribe$)).subscribe(() => this.endPan());
                fromEvent(hammer, 'swiperight').pipe(takeUntil(this.ngUnsubscribe$)).subscribe(() => this.swipe(-1));
                fromEvent(hammer, 'swipeleft').pipe(takeUntil(this.ngUnsubscribe$)).subscribe(() => this.swipe(1));
            }
        });
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.ngUnsubscribe$.next();
        this.ngUnsubscribe$.complete();
    }
    /**
     * @param {?} event
     * @return {?}
     */
    done(event) {
        if (event.toState === this.lastDoneEventToState) {
            // workaround for https://github.com/angular/angular/issues/24084
            return;
        }
        this.lastDoneEventToState = event.toState;
        if (/** @type {?} */ (typeof event.toState) === 'number') {
            this.slideDone.emit(/** @type {?} */ (event.toState));
        }
    }
    /**
     * @param {?} direction
     * @return {?}
     */
    slide(direction) {
        this.changeSlideTrigger();
        setTimeout(() => this.changeSlideTrigger(/** @type {?} */ (direction)));
    }
    /**
     * @return {?}
     */
    startPress() {
        this.notPanning = true;
    }
    /**
     * @return {?}
     */
    startPan() {
        this.notPanning = false;
        this.wrapperWidth = this.hostRef.nativeElement.offsetWidth;
    }
    /**
     * @param {?} event
     * @return {?}
     */
    pan(event) {
        const /** @type {?} */ multiplier = (event.deltaX > 0 && this.prevDisabled || event.deltaX < 0 && this.nextDisabled) ? 0.1 : 1;
        const /** @type {?} */ absOffset = Math.abs(event.deltaX / this.wrapperWidth);
        this.panOffset = Math.sign(event.deltaX) * this.easeOut(absOffset);
        this.changeSlideTrigger('panning', this.panOffset * multiplier);
    }
    /**
     * @return {?}
     */
    endPan() {
        if (Math.abs(this.panOffset) > 0.5) {
            this.changeSlideTrigger(/** @type {?} */ (-Math.sign(this.panOffset)));
        }
        else if (this.slideTrigger.value === 'panning') {
            this.changeSlideTrigger();
        }
    }
    /**
     * @param {?} direction
     * @return {?}
     */
    swipe(direction) {
        this.changeSlideTrigger(/** @type {?} */ (direction));
    }
    /**
     * @param {?=} value
     * @param {?=} offset
     * @return {?}
     */
    changeSlideTrigger(value = 'idle', offset = 0) {
        this.slideTrigger = {
            value: (value === -1 && this.prevDisabled || value === 1 && this.nextDisabled) ? 'idle' : value,
            params: { x: offset * 100 },
        };
        this.cd.detectChanges();
    }
}
SliderComponent.decorators = [
    { type: Component, args: [{
                selector: 'skm-slider',
                template: `<div class="skm-datepicker-slider" [@slide]="slideTrigger" (@slide.done)="done($event)">
  <ng-content></ng-content>
</div>
<button type="button" class="skm-datepicker-pagination skm-prev" (click)="slide(-1)" [disabled]="prevDisabled">&lsaquo;</button>
<button type="button" class="skm-datepicker-pagination skm-next" (click)="slide(1)" [disabled]="nextDisabled">&rsaquo;</button>
`,
                styles: [`:host{display:block;position:relative;height:100%}.skm-datepicker-slider{display:flex;position:relative;left:-100%;height:100%}.skm-datepicker-pagination{position:absolute;top:0}.skm-datepicker-pagination.skm-prev{left:0}.skm-datepicker-pagination.skm-next{right:0}`, `button{display:block;color:inherit}button:not([disabled]){cursor:pointer}button[disabled]{pointer-events:none}.skm-datepicker-pane{flex-shrink:0;width:100%;display:flex;flex-direction:column;overflow:hidden}.skm-datepicker-week{display:flex}.skm-datepicker-weekday{width:14.28571%}.skm-datepicker-content{flex:1 0 0;display:flex;flex-direction:column}.skm-datepicker-grid{flex:1 0 0;display:flex;flex-wrap:wrap;align-content:flex-start;pointer-events:none}.skm-datepicker-indent{height:16.66667%}.skm-datepicker-cell{display:flex}:host-context(.skm-datepicker-days-view) .skm-datepicker-cell{width:14.28571%;height:16.66667%}:host-context(.skm-datepicker-months-view) .skm-datepicker-cell{width:33.33333%;height:25%}:host-context(.skm-datepicker-years-view) .skm-datepicker-cell{width:20%;height:25%}.skm-datepicker-item{flex:1;pointer-events:auto}`],
                animations: [slide()],
                changeDetection: ChangeDetectionStrategy.OnPush,
            },] },
];
/** @nocollapse */
SliderComponent.ctorParameters = () => [
    { type: ElementRef, },
    { type: ChangeDetectorRef, },
    { type: NgZone, },
];
SliderComponent.propDecorators = {
    "prevDisabled": [{ type: Input },],
    "nextDisabled": [{ type: Input },],
    "slideDone": [{ type: Output },],
};
function SliderComponent_tsickle_Closure_declarations() {
    /** @type {!Array<{type: !Function, args: (undefined|!Array<?>)}>} */
    SliderComponent.decorators;
    /**
     * @nocollapse
     * @type {function(): !Array<(null|{type: ?, decorators: (undefined|!Array<{type: !Function, args: (undefined|!Array<?>)}>)})>}
     */
    SliderComponent.ctorParameters;
    /** @type {!Object<string,!Array<{type: !Function, args: (undefined|!Array<?>)}>>} */
    SliderComponent.propDecorators;
    /** @type {?} */
    SliderComponent.prototype.prevDisabled;
    /** @type {?} */
    SliderComponent.prototype.nextDisabled;
    /** @type {?} */
    SliderComponent.prototype.slideDone;
    /** @type {?} */
    SliderComponent.prototype.notPanning;
    /** @type {?} */
    SliderComponent.prototype.slideTrigger;
    /** @type {?} */
    SliderComponent.prototype.wrapperWidth;
    /** @type {?} */
    SliderComponent.prototype.panOffset;
    /** @type {?} */
    SliderComponent.prototype.lastDoneEventToState;
    /** @type {?} */
    SliderComponent.prototype.ngUnsubscribe$;
    /** @type {?} */
    SliderComponent.prototype.easeOut;
    /** @type {?} */
    SliderComponent.prototype.hostRef;
    /** @type {?} */
    SliderComponent.prototype.cd;
    /** @type {?} */
    SliderComponent.prototype.zone;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2xpZGVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL3NraW1tZWQtZGF0ZXBpY2tlci8iLCJzb3VyY2VzIjpbImxpYi9zbGlkZXIvc2xpZGVyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUVMLHVCQUF1QixFQUN2QixpQkFBaUIsRUFDakIsU0FBUyxFQUNULFVBQVUsRUFDVixZQUFZLEVBQ1osS0FBSyxFQUNMLE1BQU0sRUFHTixNQUFNLEdBRVAsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBRWhELE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUMxQyxPQUFPLEVBQUUsU0FBUyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMxQyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7Ozs7Ozs7Ozs7O0FBdUIzQyxNQUFNOzs7Ozs7SUFnQkosWUFBb0IsT0FBbUIsRUFBVSxFQUFxQixFQUFVLElBQVk7UUFBeEUsWUFBTyxHQUFQLE9BQU8sQ0FBWTtRQUFVLE9BQUUsR0FBRixFQUFFLENBQW1CO1FBQVUsU0FBSSxHQUFKLElBQUksQ0FBUTs0QkFmcEUsS0FBSzs0QkFDTCxLQUFLO3lCQUVQLElBQUksWUFBWSxFQUFVOzBCQUNuQyxJQUFJOzRCQUlNLENBQUM7eUJBQ0osQ0FBQzs4QkFHYSxJQUFJLE9BQU8sRUFBRTt1QkFDcEIsYUFBYSxDQUFDLEdBQUcsQ0FBQztRQUczQyxJQUFJLENBQUMsRUFBRSxDQUFDLE1BQU0sRUFBRSxDQUFDO0tBQ2xCOzs7OztJQUVELFdBQVcsQ0FBQyxPQUFzQjtRQUNoQyxJQUFJLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztLQUMzQjs7OztJQUVELGVBQWU7UUFDYixJQUFJLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLEdBQUcsRUFBRTtZQUMvQix1QkFB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LENBQUM7UUFDaEYsSUFBSSxDQUFDLFlBQVksR0FBRztZQUNsQixLQUFLLEVBQUUsQ0FBQyxLQUFLLEtBQUssQ0FBQyxDQUFDLElBQUksSUFBSSxDQUFDLFlBQVksSUFBSSxLQUFLLEtBQUssQ0FBQyxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxLQUFLO1lBQy9GLE1BQU0sRUFBRSxFQUFDLENBQUMsRUFBRSxNQUFNLEdBQUcsR0FBRyxFQUFDO1NBQzFCLENBQUM7UUFDRixJQUFJLENBQUMsRUFBRSxDQUFDLGFBQWEsRUFBRSxDQUFDOzs7O1lBNUczQixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLFlBQVk7Z0JBQ3RCLFFBQVEsRUFBRTs7Ozs7Q0FLWDtnQkFDQyxNQUFNLEVBQUUsQ0FBQywyUUFBMlEsRUFBRSxrMUJBQWsxQixDQUFDO2dCQUN6bUMsVUFBVSxFQUFFLENBQUMsS0FBSyxFQUFFLENBQUM7Z0JBQ3JCLGVBQWUsRUFBRSx1QkFBdUIsQ0FBQyxNQUFNO2FBQ2hEOzs7O1lBbkNDLFVBQVU7WUFGVixpQkFBaUI7WUFLakIsTUFBTTs7OzZCQWtDTCxLQUFLOzZCQUNMLEtBQUs7MEJBRUwsTUFBTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgQWZ0ZXJWaWV3SW5pdCxcclxuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcclxuICBDaGFuZ2VEZXRlY3RvclJlZixcclxuICBDb21wb25lbnQsXHJcbiAgRWxlbWVudFJlZixcclxuICBFdmVudEVtaXR0ZXIsXHJcbiAgSW5wdXQsXHJcbiAgTmdab25lLFxyXG4gIE9uQ2hhbmdlcyxcclxuICBPbkRlc3Ryb3ksXHJcbiAgT3V0cHV0LFxyXG4gIFNpbXBsZUNoYW5nZXMsXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IGNyZWF0ZUVhc2VPdXQgfSBmcm9tICcuLi91dGlsL2hlbHBlcnMnO1xyXG5pbXBvcnQgeyBBbmltYXRpb25FdmVudCB9IGZyb20gJ0Bhbmd1bGFyL2FuaW1hdGlvbnMnO1xyXG5pbXBvcnQgeyBzbGlkZSB9IGZyb20gJy4vc2xpZGUuYW5pbWF0aW9uJztcclxuaW1wb3J0IHsgZnJvbUV2ZW50LCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IHRha2VVbnRpbCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuXHJcbmRlY2xhcmUgY2xhc3MgSGFtbWVyIGV4dGVuZHMgRXZlbnRUYXJnZXQge1xyXG4gIGNvbnN0cnVjdG9yKHRhcmdldDogRXZlbnRUYXJnZXQpO1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIEFuaW1hdGlvblRyaWdnZXIge1xyXG4gIHZhbHVlOiBzdHJpbmcgfCBudW1iZXI7XHJcbiAgcGFyYW1zOiB7IFtwOiBzdHJpbmddOiBhbnkgfTtcclxufVxyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdza20tc2xpZGVyJyxcclxuICB0ZW1wbGF0ZTogYDxkaXYgY2xhc3M9XCJza20tZGF0ZXBpY2tlci1zbGlkZXJcIiBbQHNsaWRlXT1cInNsaWRlVHJpZ2dlclwiIChAc2xpZGUuZG9uZSk9XCJkb25lKCRldmVudClcIj5cclxuICA8bmctY29udGVudD48L25nLWNvbnRlbnQ+XHJcbjwvZGl2PlxyXG48YnV0dG9uIHR5cGU9XCJidXR0b25cIiBjbGFzcz1cInNrbS1kYXRlcGlja2VyLXBhZ2luYXRpb24gc2ttLXByZXZcIiAoY2xpY2spPVwic2xpZGUoLTEpXCIgW2Rpc2FibGVkXT1cInByZXZEaXNhYmxlZFwiPiZsc2FxdW87PC9idXR0b24+XHJcbjxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwic2ttLWRhdGVwaWNrZXItcGFnaW5hdGlvbiBza20tbmV4dFwiIChjbGljayk9XCJzbGlkZSgxKVwiIFtkaXNhYmxlZF09XCJuZXh0RGlzYWJsZWRcIj4mcnNhcXVvOzwvYnV0dG9uPlxyXG5gLFxyXG4gIHN0eWxlczogW2A6aG9zdHtkaXNwbGF5OmJsb2NrO3Bvc2l0aW9uOnJlbGF0aXZlO2hlaWdodDoxMDAlfS5za20tZGF0ZXBpY2tlci1zbGlkZXJ7ZGlzcGxheTpmbGV4O3Bvc2l0aW9uOnJlbGF0aXZlO2xlZnQ6LTEwMCU7aGVpZ2h0OjEwMCV9LnNrbS1kYXRlcGlja2VyLXBhZ2luYXRpb257cG9zaXRpb246YWJzb2x1dGU7dG9wOjB9LnNrbS1kYXRlcGlja2VyLXBhZ2luYXRpb24uc2ttLXByZXZ7bGVmdDowfS5za20tZGF0ZXBpY2tlci1wYWdpbmF0aW9uLnNrbS1uZXh0e3JpZ2h0OjB9YCwgYGJ1dHRvbntkaXNwbGF5OmJsb2NrO2NvbG9yOmluaGVyaXR9YnV0dG9uOm5vdChbZGlzYWJsZWRdKXtjdXJzb3I6cG9pbnRlcn1idXR0b25bZGlzYWJsZWRde3BvaW50ZXItZXZlbnRzOm5vbmV9LnNrbS1kYXRlcGlja2VyLXBhbmV7ZmxleC1zaHJpbms6MDt3aWR0aDoxMDAlO2Rpc3BsYXk6ZmxleDtmbGV4LWRpcmVjdGlvbjpjb2x1bW47b3ZlcmZsb3c6aGlkZGVufS5za20tZGF0ZXBpY2tlci13ZWVre2Rpc3BsYXk6ZmxleH0uc2ttLWRhdGVwaWNrZXItd2Vla2RheXt3aWR0aDoxNC4yODU3MSV9LnNrbS1kYXRlcGlja2VyLWNvbnRlbnR7ZmxleDoxIDAgMDtkaXNwbGF5OmZsZXg7ZmxleC1kaXJlY3Rpb246Y29sdW1ufS5za20tZGF0ZXBpY2tlci1ncmlke2ZsZXg6MSAwIDA7ZGlzcGxheTpmbGV4O2ZsZXgtd3JhcDp3cmFwO2FsaWduLWNvbnRlbnQ6ZmxleC1zdGFydDtwb2ludGVyLWV2ZW50czpub25lfS5za20tZGF0ZXBpY2tlci1pbmRlbnR7aGVpZ2h0OjE2LjY2NjY3JX0uc2ttLWRhdGVwaWNrZXItY2VsbHtkaXNwbGF5OmZsZXh9Omhvc3QtY29udGV4dCguc2ttLWRhdGVwaWNrZXItZGF5cy12aWV3KSAuc2ttLWRhdGVwaWNrZXItY2VsbHt3aWR0aDoxNC4yODU3MSU7aGVpZ2h0OjE2LjY2NjY3JX06aG9zdC1jb250ZXh0KC5za20tZGF0ZXBpY2tlci1tb250aHMtdmlldykgLnNrbS1kYXRlcGlja2VyLWNlbGx7d2lkdGg6MzMuMzMzMzMlO2hlaWdodDoyNSV9Omhvc3QtY29udGV4dCguc2ttLWRhdGVwaWNrZXIteWVhcnMtdmlldykgLnNrbS1kYXRlcGlja2VyLWNlbGx7d2lkdGg6MjAlO2hlaWdodDoyNSV9LnNrbS1kYXRlcGlja2VyLWl0ZW17ZmxleDoxO3BvaW50ZXItZXZlbnRzOmF1dG99YF0sXHJcbiAgYW5pbWF0aW9uczogW3NsaWRlKCldLFxyXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgU2xpZGVyQ29tcG9uZW50IGltcGxlbWVudHMgT25DaGFuZ2VzLCBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3kge1xyXG4gIEBJbnB1dCgpIHByZXZEaXNhYmxlZCA9IGZhbHNlO1xyXG4gIEBJbnB1dCgpIG5leHREaXNhYmxlZCA9IGZhbHNlO1xyXG5cclxuICBAT3V0cHV0KCkgc2xpZGVEb25lID0gbmV3IEV2ZW50RW1pdHRlcjxudW1iZXI+KCk7XHJcbiAgbm90UGFubmluZyA9IHRydWU7XHJcblxyXG4gIHNsaWRlVHJpZ2dlcjogQW5pbWF0aW9uVHJpZ2dlcjtcclxuXHJcbiAgcHJpdmF0ZSB3cmFwcGVyV2lkdGggPSAxO1xyXG4gIHByaXZhdGUgcGFuT2Zmc2V0ID0gMDtcclxuICBwcml2YXRlIGxhc3REb25lRXZlbnRUb1N0YXRlOiBzdHJpbmcgfCBudW1iZXI7XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgbmdVbnN1YnNjcmliZSQgPSBuZXcgU3ViamVjdCgpO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgZWFzZU91dCA9IGNyZWF0ZUVhc2VPdXQoMS4zKTtcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBob3N0UmVmOiBFbGVtZW50UmVmLCBwcml2YXRlIGNkOiBDaGFuZ2VEZXRlY3RvclJlZiwgcHJpdmF0ZSB6b25lOiBOZ1pvbmUpIHtcclxuICAgIHRoaXMuY2QuZGV0YWNoKCk7XHJcbiAgfVxyXG5cclxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XHJcbiAgICB0aGlzLmNoYW5nZVNsaWRlVHJpZ2dlcigpO1xyXG4gIH1cclxuXHJcbiAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xyXG4gICAgdGhpcy56b25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcclxuICAgICAgY29uc3QgaG9zdCA9IHRoaXMuaG9zdFJlZi5uYXRpdmVFbGVtZW50O1xyXG4gICAgICBmcm9tRXZlbnQoaG9zdCwgJ21vdXNlZG93bicpLnBpcGUodGFrZVVudGlsKHRoaXMubmdVbnN1YnNjcmliZSQpKS5zdWJzY3JpYmUoKCkgPT4gdGhpcy5zdGFydFByZXNzKCkpO1xyXG5cclxuICAgICAgaWYgKCdIYW1tZXInIGluIHdpbmRvdykge1xyXG4gICAgICAgIGNvbnN0IGhhbW1lciA9IG5ldyBIYW1tZXIoaG9zdCk7XHJcblxyXG4gICAgICAgIGZyb21FdmVudChoYW1tZXIsICdwYW5zdGFydCcpLnBpcGUodGFrZVVudGlsKHRoaXMubmdVbnN1YnNjcmliZSQpKS5zdWJzY3JpYmUoKCkgPT4gdGhpcy5zdGFydFBhbigpKTtcclxuICAgICAgICBmcm9tRXZlbnQoaGFtbWVyLCAncGFubW92ZScpLnBpcGUodGFrZVVudGlsKHRoaXMubmdVbnN1YnNjcmliZSQpKS5zdWJzY3JpYmUoZSA9PiB0aGlzLnBhbihlKSk7XHJcbiAgICAgICAgZnJvbUV2ZW50KGhhbW1lciwgJ3BhbmVuZCBwYW5jYW5jZWwnKS5waXBlKHRha2VVbnRpbCh0aGlzLm5nVW5zdWJzY3JpYmUkKSkuc3Vic2NyaWJlKCgpID0+IHRoaXMuZW5kUGFuKCkpO1xyXG5cclxuICAgICAgICBmcm9tRXZlbnQoaGFtbWVyLCAnc3dpcGVyaWdodCcpLnBpcGUodGFrZVVudGlsKHRoaXMubmdVbnN1YnNjcmliZSQpKS5zdWJzY3JpYmUoKCkgPT4gdGhpcy5zd2lwZSgtMSkpO1xyXG4gICAgICAgIGZyb21FdmVudChoYW1tZXIsICdzd2lwZWxlZnQnKS5waXBlKHRha2VVbnRpbCh0aGlzLm5nVW5zdWJzY3JpYmUkKSkuc3Vic2NyaWJlKCgpID0+IHRoaXMuc3dpcGUoMSkpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xyXG4gICAgdGhpcy5uZ1Vuc3Vic2NyaWJlJC5uZXh0KCk7XHJcbiAgICB0aGlzLm5nVW5zdWJzY3JpYmUkLmNvbXBsZXRlKCk7XHJcbiAgfVxyXG5cclxuICBkb25lKGV2ZW50OiBBbmltYXRpb25FdmVudCk6IHZvaWQge1xyXG4gICAgaWYgKGV2ZW50LnRvU3RhdGUgPT09IHRoaXMubGFzdERvbmVFdmVudFRvU3RhdGUpIHtcclxuICAgICAgLy8gd29ya2Fyb3VuZCBmb3IgaHR0cHM6Ly9naXRodWIuY29tL2FuZ3VsYXIvYW5ndWxhci9pc3N1ZXMvMjQwODRcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5sYXN0RG9uZUV2ZW50VG9TdGF0ZSA9IGV2ZW50LnRvU3RhdGU7XHJcbiAgICBpZiAodHlwZW9mIGV2ZW50LnRvU3RhdGUgYXMgc3RyaW5nIHwgbnVtYmVyID09PSAnbnVtYmVyJykge1xyXG4gICAgICB0aGlzLnNsaWRlRG9uZS5lbWl0KGV2ZW50LnRvU3RhdGUgYXMgYW55KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHNsaWRlKGRpcmVjdGlvbjogbnVtYmVyKTogdm9pZCB7XHJcbiAgICB0aGlzLmNoYW5nZVNsaWRlVHJpZ2dlcigpO1xyXG4gICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLmNoYW5nZVNsaWRlVHJpZ2dlcihkaXJlY3Rpb24gYXMgLTEgfCAxKSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHN0YXJ0UHJlc3MoKTogdm9pZCB7XHJcbiAgICB0aGlzLm5vdFBhbm5pbmcgPSB0cnVlO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzdGFydFBhbigpOiB2b2lkIHtcclxuICAgIHRoaXMubm90UGFubmluZyA9IGZhbHNlO1xyXG4gICAgdGhpcy53cmFwcGVyV2lkdGggPSB0aGlzLmhvc3RSZWYubmF0aXZlRWxlbWVudC5vZmZzZXRXaWR0aDtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgcGFuKGV2ZW50OiBhbnkpOiB2b2lkIHtcclxuICAgIGNvbnN0IG11bHRpcGxpZXIgPSAoZXZlbnQuZGVsdGFYID4gMCAmJiB0aGlzLnByZXZEaXNhYmxlZCB8fCBldmVudC5kZWx0YVggPCAwICYmIHRoaXMubmV4dERpc2FibGVkKSA/IDAuMSA6IDE7XHJcbiAgICBjb25zdCBhYnNPZmZzZXQgPSBNYXRoLmFicyhldmVudC5kZWx0YVggLyB0aGlzLndyYXBwZXJXaWR0aCk7XHJcbiAgICB0aGlzLnBhbk9mZnNldCA9IE1hdGguc2lnbihldmVudC5kZWx0YVgpICogdGhpcy5lYXNlT3V0KGFic09mZnNldCk7XHJcbiAgICB0aGlzLmNoYW5nZVNsaWRlVHJpZ2dlcigncGFubmluZycsIHRoaXMucGFuT2Zmc2V0ICogbXVsdGlwbGllcik7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGVuZFBhbigpOiB2b2lkIHtcclxuICAgIGlmIChNYXRoLmFicyh0aGlzLnBhbk9mZnNldCkgPiAwLjUpIHtcclxuICAgICAgdGhpcy5jaGFuZ2VTbGlkZVRyaWdnZXIoLU1hdGguc2lnbih0aGlzLnBhbk9mZnNldCkgYXMgLTEgfCAxKTtcclxuICAgIH0gZWxzZSBpZiAodGhpcy5zbGlkZVRyaWdnZXIudmFsdWUgPT09ICdwYW5uaW5nJykge1xyXG4gICAgICB0aGlzLmNoYW5nZVNsaWRlVHJpZ2dlcigpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzd2lwZShkaXJlY3Rpb246IG51bWJlcik6IHZvaWQge1xyXG4gICAgdGhpcy5jaGFuZ2VTbGlkZVRyaWdnZXIoZGlyZWN0aW9uIGFzIC0xIHwgMSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNoYW5nZVNsaWRlVHJpZ2dlcih2YWx1ZTogJ3Bhbm5pbmcnIHwgJ2lkbGUnIHwgLTEgfCAxID0gJ2lkbGUnLCBvZmZzZXQgPSAwKTogdm9pZCB7XHJcbiAgICB0aGlzLnNsaWRlVHJpZ2dlciA9IHtcclxuICAgICAgdmFsdWU6ICh2YWx1ZSA9PT0gLTEgJiYgdGhpcy5wcmV2RGlzYWJsZWQgfHwgdmFsdWUgPT09IDEgJiYgdGhpcy5uZXh0RGlzYWJsZWQpID8gJ2lkbGUnIDogdmFsdWUsXHJcbiAgICAgIHBhcmFtczoge3g6IG9mZnNldCAqIDEwMH0sXHJcbiAgICB9O1xyXG4gICAgdGhpcy5jZC5kZXRlY3RDaGFuZ2VzKCk7XHJcbiAgfVxyXG5cclxufVxyXG4iXX0=